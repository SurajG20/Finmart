<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Vinayak Finmart Pvt. Ltd.</title>
    <!-- <link rel="shortcut icon" href="#" type="image/x-icon"> -->

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <!-- bootstrap link -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <!-- google font icons link -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <!-- font awesome icons link -->
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>

    <!-- dashboard links  start  -->

    <!-- Include jQuery -->
    <!-- Include necessary CSS files -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/devextreme/dist/css/dx.common.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/devextreme/dist/css/dx.light.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Include DevExtreme library -->
    <script src="https://cdn.jsdelivr.net/npm/devextreme/dist/js/dx.all.js"></script>

    <!-- bootstrap links  End  -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />

    <!-- CSS here -->
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/bootstrap.min.css"
      media="all"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/elegant-icons.min.css"
      media="all"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/all.min.css"
      media="all"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/animate.css"
      media="all"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/nice-select.css"
      media="all"
    />
    <link rel="stylesheet" type="text/css" href="/css/slick.css" media="all" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/slick-theme.css"
      media="all"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/default.css"
      media="all"
    />
    <link rel="stylesheet" type="text/css" href="/css/admin.css" media="all" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/responsive.css"
      media="all"
    />
  </head>

  <body class="admin" id="admin">
    <div class="sidebar">
      <div class="logo-details">
        <i class="bx bxl-c-plus-plus"></i>
        <a class="navbar-brand" href="/">
          <h5 class="text-light">Vinayak Finmart</h5>
        </a>
      </div>
      <nav id="sidebar">
        <ul class="nav-links" id="sidebar">
          <!-- Dashboard  -->
          <li class="active">
            <a href="/admin">
              <i class="bx bx-grid-alt"></i>
              <span class="links_name fw-bold">Dashboard</span>
            </a>
          </li>

          <!-- button  -->
          <li
            class="log_out d-flex justify-content-between align-items-center text-center"
          >
            <form class="m-auto" action="/logout" method="get">
              <button
                class="btn px-4 btn-danger d-flex justify-content-between align-items-center gap-2"
              >
                LOGOUT
              </button>
            </form>
          </li>
        </ul>
      </nav>
    </div>
    <section class="home-section">
      <nav>
        <div class="d-flex justify-content-end align-items-center gap-5">
          <div class="btn-group" role="group" aria-label="Basic example">
            <button
              type="button"
              class="btn btn-primary"
              id="personalDetailBtn"
            >
              Personal Detail
            </button>
            <button type="button" class="btn btn-primary" id="loanDetailBtn">
              Loan Detail
            </button>
          </div>
          <div class="btn-group" role="group" aria-label="Basic example">
            <button
              type="button"
              class="btn btn-primary"
              id="applicationDetailBtn"
            >
              Application Status
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="documentDetailBtn"
            >
              Document
            </button>
          </div>
          <div class="btn-group" role="group" aria-label="Basic example">
            <button type="button" class="btn btn-primary" id="notificationBtn">
              Notification
            </button>
          </div>
        </div>
        <div class="profile-details">
          <span class="admin_name">
            <%= `${singleUserData?.personalDetails?.firstName}
            ${singleUserData?.personalDetails?.lastName}`%>
          </span>
        </div>
      </nav>

      <div class="home-content admin">
        <div class="sales-boxes">
          <div class="recent-sales box">
            <div class="sales-details d-block">
              <!-- Home Dashboard -->

              <!-- User Details  -->
              <div>
                <!-- content section -->
                <div class="container-fluid my-5">
                  <!-- Personal details -->
                  <div class="personaldetail" id="personalDetail">
                    <div class="loan-details-widget">
                      <h2 class="text-secondary text-center mb-5">
                        Personal Details
                      </h2>
                      <div enctype="multipart/form-data">
                        <div class="row gy-4">
                          <div class="col-md-12">
                            <label class="label" for="fName">Full Name</label>
                            <div
                              class="form-control d-flex align-items-center text-secondary"
                              style="cursor: default"
                              type="text"
                              name="firstName"
                              required
                            >
                              <%= `${singleUserData?.personalDetails?.firstName}
                              ${singleUserData?.personalDetails?.lastName}`%>
                            </div>
                          </div>

                          <div class="col-md-6">
                            <label class="label" for="fName"
                              >D.O.B (Date of Birth)</label
                            >
                            <div
                              id="fName"
                              class="form-control d-flex align-items-center text-secondary"
                              style="cursor: default"
                              type="text"
                              name="firstName"
                              required
                            >
                              <%= singleUserData?.personalDetails?.dateOfBirth
                              %>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <label class="label mb-4">Marital Status</label>
                            <div class="form-check form-check-inline me-5">
                              <label
                                class="form-check-label text-dark fw-bold"
                                for="married"
                              >
                                <%=
                                singleUserData?.personalDetails?.MaritalStatus
                                %>
                              </label>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <label class="label" for="fName"
                              >Email Address</label
                            >
                            <div
                              class="form-control d-flex align-items-center text-secondary"
                              style="cursor: default"
                              type="text"
                              name="firstName"
                              required
                            >
                              <%= singleUserData?.personalDetails?.email %>
                            </div>
                          </div>

                          <div class="col-md-6">
                            <label class="label" for="fName"
                              >Mobile Number</label
                            >
                            <div
                              class="form-control d-flex align-items-center text-secondary"
                              style="cursor: default"
                              type="text"
                              name="firstName"
                              required
                            >
                              +91 <%=
                              singleUserData?.personalDetails?.mobileNumber %>
                            </div>
                          </div>

                          <div class="col-md-12">
                            <label class="label" for="fName"
                              >Permanent Address</label
                            >
                            <div
                              class="form-control d-flex align-items-center text-secondary"
                              style="cursor: default"
                              type="text"
                              name="firstName"
                              required
                            >
                              <%=
                              singleUserData?.personalDetails?.presentAddress %>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- Loan Details  -->
                  <div class="loandetail" id="loanDetail">
                    <div class="loan-details-widget">
                      <div enctype="multipart/form-data">
                        <div class="row mb-35 gy-4">
                          <div class="col-lg-3 col-md-6">
                            <label for="Personal_loan" class="loan-type">
                              <%=
                              singleUserData?.loanDetails?.['select-loan-type']
                              %>
                              <span> </span>
                            </label>
                          </div>
                        </div>
                        <div class="row gy-4">
                          <div class="col-md-6">
                            <label class="label" for="loandetails01"
                              >Financing type</label
                            >
                            <div
                              id="loandetails01"
                              class="form-control d-flex align-items-center text-secondary"
                              style="cursor: default"
                              type="text"
                              name="firstName"
                              required
                            >
                              <%= singleUserData?.loanDetails?.financingType %>
                            </div>
                          </div>

                          <!-- bank type  -->
                          <div class="col-md-6">
                            <label class="label" for="loandetails02"
                              >Bank Service</label
                            >
                            <div
                              id="loandetails02"
                              class="form-control d-flex align-items-center text-secondary"
                              style="cursor: default"
                              type="text"
                              name="firstName"
                              required
                            >
                              <%= singleUserData?.loanDetails?.bankService %>
                            </div>
                          </div>

                          <!-- loan Amount -->
                          <div class="col-md-6">
                            <label class="label" for="loandetails03"
                              >Yout loan amount</label
                            >
                            <div
                              id="loandetails03"
                              class="form-control d-flex align-items-center text-secondary"
                              style="cursor: default"
                              type="text"
                              name="firstName"
                              required
                            >
                              ₹ <%= singleUserData?.loanDetails?.loanAmount %>
                            </div>
                          </div>

                          <div class="col-md-12">
                            <label class="label mb-4">Loan duration</label>

                            <div class="form-check form-check-inline mr-30">
                              <label
                                class="form-check-label"
                                for="inlineRadio1"
                              >
                                <%= singleUserData?.loanDetails?.tenureDuration
                                %> <%= singleUserData?.loanDetails?.tenureUnit
                                %></label
                              >
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Documents Detials  -->
                  <div class="document" id="documentDetail">
                    <div class="images d-flex gap-5 flex-wrap bg-light">
                      <% singleUserData?.documentUploads?.forEach(element=> { %>
                      <div class="item">
                        <div
                          style="height: 100px; width: 100px"
                          class="object-fit-cover"
                        >
                          <a href="<%= element?.url  %>" target="_blank">
                            <img
                              height="100%"
                              width="100%"
                              src="https://cdn-icons-png.flaticon.com/128/8760/8760611.png"
                              alt="folder image"
                            />
                          </a>
                        </div>
                        <p class="text-center"><%= element?.filename %></p>
                      </div>
                      <% }) %>
                    </div>
                  </div>
                  <!-- Application Detials  -->
                  <div class="applicationstatus" id="applicationDetail">
                    <div
                      class="card card-body shadow p-3 mb-5 bg-white rounded"
                    >
                      <form
                        method="post"
                        action="/admin/user-details/updateStatus/<%= singleUserData.userId %>"
                      >
                        <div class="d-flex flex-column gap-3">
                          <div class="d-flex align-items-center">
                            <h4 class="text-center flex-grow-1">Loan Status</h4>
                            <div class="ml-auto">
                              <!-- Replace the dropdown with a select input -->
                              <select class="form-select" name="loanStatus">
                                <option value="" selected>Select Status</option>
                                <option value="Approved">Approved</option>
                                <option value="Pending">Pending</option>
                                <option value="Rejected">Rejected</option>
                              </select>
                            </div>
                          </div>

                          <!-- Perosnla details  -->
                          <div>
                            <h5 class="text-secondary">Personal Detail</h5>
                            <div class="d-flex gap-5">
                              <div class="d-flex gap-2 align-items-center">
                                <span class="text-secondary">Name :</span>
                                <span>
                                  <%=
                                  `${singleUserData?.personalDetails?.firstName}
                                  ${singleUserData?.personalDetails?.lastName}`%>
                                </span>
                              </div>
                              <div class="d-flex gap-2 align-items-center">
                                <span class="text-secondary">Email :</span>
                                <span>
                                  <%= singleUserData?.personalDetails?.email %>
                                </span>
                              </div>
                              <div class="d-flex gap-2 align-items-center">
                                <span class="text-secondary">Contact No :</span>
                                <div>
                                  <span class="text-secondary">+91</span>
                                  <span>
                                    <%=
                                    singleUserData?.personalDetails?.mobileNumber
                                    %>
                                  </span>
                                </div>
                              </div>
                            </div>
                          </div>
                          <!-- Loan details  -->
                          <div>
                            <h5 class="text-secondary">Loan Detail</h5>
                            <div class="d-flex gap-5">
                              <div class="d-flex gap-2 align-items-center">
                                <span class="text-secondary">Loan Type :</span>
                                <span>
                                  <%=
                                  singleUserData?.loanDetails?.['select-loan-type']
                                  %>
                                </span>
                              </div>
                              <div class="d-flex gap-2 align-items-center">
                                <span class="text-secondary"
                                  >Loan Amount :</span
                                >
                                <div>
                                  <span class="text-secondary">₹</span>
                                  <span>
                                    <%= singleUserData?.loanDetails?.loanAmount
                                    %>
                                  </span>
                                </div>
                              </div>
                              <div class="d-flex gap-2 align-items-center">
                                <span class="text-secondary"
                                  >Emi Per Month :</span
                                >
                                <div>
                                  <span class="text-secondary">₹</span>
                                  <span> <%= emi ? emi : "Na" %> </span>
                                </div>
                              </div>
                            </div>
                          </div>
                          <!-- User Notification  -->
                          <div class="notificationContainer">
                            <h5 class="text-secondary">Application Details</h5>
                            <div class="d-flex gap-5">
                              <div class="d-flex gap-2 align-items-center">
                                <span class="text-secondary">Status:</span>
                                <div>
                                  <span>
                                    <%= singleUserData?.ApplicationStatus %>
                                  </span>
                                </div>
                              </div>
                            </div>
                          </div>

                          <div
                            class="d-flex justify-content-end align-items-center"
                          >
                            <button type="submit" class="btn btn-primary">
                              Submit
                            </button>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>

                  <!-- Notificatoin section  -->
                  <div class="notificationContainer" id="notificationContainer">
                    <div class="row">
                      <div
                        class="col-md-6 contact-form-widget card card-body d-flex flex-column flex-fill"
                      >
                        <form
                          action="/admin/send-notification/<%= singleUserData?.userId %>"
                          method="POST"
                        >
                          <div class="row">
                            <!-- Notification section -->
                            <!-- Title -->
                            <div class="col-md-12">
                              <label for="notification"
                                >Notification Title</label
                              >
                              <input
                                type="text"
                                id="notification"
                                name="title"
                                class="form-control"
                                placeholder="What's is Notification Title?"
                                required
                              />
                            </div>

                            <!-- message  section -->
                            <div class="col-md-12 mt-20">
                              <label for="form-text"
                                >Notification Messages</label
                              >
                              <textarea
                                cols="30"
                                rows="5"
                                name="message"
                                id="form-text"
                                class="form-control pt-15"
                                placeholder="Your message......"
                                required
                              ></textarea>
                            </div>
                            <!-- button section  -->
                            <div class="col-12 mt-35">
                              <button
                                type="submit"
                                class="btn btn-primary w-100"
                              >
                                Send Now
                              </button>
                            </div>
                          </div>
                        </form>
                      </div>
                      <div
                        class="col-md-6 d-flex flex-column container-fluid gap-3"
                        style="overflow-y: scroll"
                      >
                        <!-- item 1 -->
                        <% allNotifications?.forEach(element=> { %>

                        <div
                          class="p-3 rounded text-sm d-flex justify-content-between"
                          style="
                            background-color: lightgray;
                            height: min-content;
                          "
                        >
                          <div>
                            <p class="fw-bold"><%= element.title %></p>
                            <%= element.message %>
                          </div>
                          <form
                            action="/admin/delete-notification/<%= element._id %>/delete?_method=DELETE"
                            method="post"
                          >
                            <button class="btn btn-primary">Delete</button>
                          </form>
                        </div>
                        <% }) %>
                        <!-- item 2 -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <script>
      let sidebar = document.querySelector('.sidebar');
      let sidebarBtn = document.querySelector('.sidebarBtn');
      sidebarBtn.onclick = function () {
        sidebar.classList.toggle('active');
        if (sidebar.classList.contains('active')) {
          sidebarBtn.classList.replace('bx-menu', 'bx-menu-alt-right');
        } else sidebarBtn.classList.replace('bx-menu-alt-right', 'bx-menu');
      };
    </script>
    <script>
      // JavaScript to handle modal behavior
      const openModalButton = document.getElementById('openModalButton');
      const modal = document.getElementById('myModal');
      const closeModal = document.getElementById('closeModal');

      openModalButton.addEventListener('click', function () {
        modal.style.display = 'block';
      });

      closeModal.addEventListener('click', function () {
        modal.style.display = 'none';
      });

      // Close the modal when clicking outside the modal content
      window.addEventListener('click', function (event) {
        if (event.target == modal) {
          modal.style.display = 'none';
        }
      });
    </script>

    <!-- bootstrap link  -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script src="/js/userDetails.js"></script>
    <!-- jquery link  -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </body>
</html>
